(()=>{"use strict";class e{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onClick",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"disabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"classList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.onClick=e.onClick,this.disabled=e.disabled,this.classList=e.classList}render(){const e=document.createElement("button");return e.textContent=this.text,this.classList.forEach((t=>{e.classList.add(`${t}`)})),e.addEventListener("click",this.onClick),this.disabled&&(e.disabled=!0),e}}class t{constructor(e){Object.defineProperty(this,"placeholder",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"classList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onChange",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e.placeholder&&(this.placeholder=e.placeholder),this.value=e.value,this.onChange=e.onChange,this.classList=e.classList,this.type=e.type}render(){const e=document.createElement("input");return this.placeholder&&(e.placeholder=this.placeholder),this.value&&(e.value=this.value),e.type=this.type,this.classList.forEach((t=>{e.classList.add(t)})),this.onChange&&e.addEventListener("input",(e=>{const{value:t}=e.target;this.onChange(t)})),e}}class a{constructor(e,t="car"){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"className",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.id=e.id,this.color=e.color,this.className=t}render(){const e=document.createElement("div");return e.classList.add("car",`car-${this.id}`,"car-svg"),e.classList.add(`${this.className}`),e.style.setProperty("--car-color",this.color),e.innerHTML='<?xml version="1.0" standalone="no"?>\n        <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN"\n         "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">\n        <svg version="1.0" xmlns="http://www.w3.org/2000/svg"\n         width="1280.000000pt" height="640.000000pt" viewBox="0 0 1280.000000 640.000000"\n         preserveAspectRatio="xMidYMid meet">\n        <metadata>\n        Created by potrace 1.15, written by Peter Selinger 2001-2017\n        </metadata>\n        <g transform="translate(0.000000,640.000000) scale(0.100000,-0.100000)"\n        fill="#000000" stroke="none">\n        <path d="M6770 5134 c-375 -32 -552 -63 -818 -141 l-123 -36 65 -66 c36 -37\n        66 -71 66 -76 0 -6 -91 -63 -203 -129 -571 -335 -1055 -650 -1193 -776 -41\n        -37 -43 -38 -148 -45 -227 -16 -445 28 -572 115 l-44 31 -118 -11 c-679 -65\n        -1470 -179 -1766 -254 -77 -20 -163 -36 -191 -36 -167 0 -424 -115 -629 -281\n        -74 -60 -99 -74 -169 -95 -132 -39 -214 -72 -347 -141 -162 -83 -291 -175\n        -412 -294 l-98 -97 0 -53 c0 -68 18 -355 30 -478 l9 -93 -55 -78 -54 -78 57\n        -27 c284 -132 811 -232 1322 -251 l180 -7 3 94 3 93 42 8 c75 12 93 1 138 -88\n        55 -110 96 -166 189 -262 169 -174 347 -268 588 -308 314 -52 628 44 873 268\n        78 71 178 206 222 298 20 41 41 78 47 83 6 4 45 6 86 5 l75 -3 -2 -66 -2 -67\n        72 -6 c75 -6 3073 -21 4227 -21 l665 0 0 55 c1 30 4 61 8 68 6 8 35 12 87 12\n        l79 0 41 -77 c116 -223 327 -412 552 -494 138 -51 208 -62 378 -63 157 -1 202\n        6 330 46 244 77 457 263 591 516 l34 64 128 5 c143 5 157 1 157 -53 0 -31 1\n        -33 33 -28 234 33 1113 156 1147 160 83 11 122 38 254 180 70 75 135 153 146\n        175 22 43 26 121 9 166 -19 49 -12 237 16 423 46 298 37 324 -170 525 -125\n        122 -148 149 -175 208 -16 37 -32 67 -34 67 -1 0 -108 27 -237 60 l-234 59 0\n        51 1 50 -61 0 c-33 0 -91 3 -128 7 l-68 6 2 53 c2 30 1 56 -2 58 -2 3 -56 -2\n        -119 -10 -63 -7 -119 -14 -123 -14 -5 0 -7 33 -6 73 1 39 -1 74 -5 76 -4 2\n        -51 -4 -105 -14 l-98 -18 -119 43 c-223 80 -838 281 -1084 355 -1119 336\n        -1827 496 -2475 560 -150 15 -665 28 -765 19z m800 -310 c214 -20 442 -53 458\n        -66 7 -7 12 -21 9 -32 -4 -20 -59 -198 -193 -623 l-57 -182 -61 -5 c-34 -3\n        -293 -13 -576 -21 -283 -9 -634 -20 -780 -25 -146 -5 -367 -12 -492 -16 l-227\n        -7 -6 39 c-30 183 -124 304 -237 304 -140 0 -324 -119 -455 -295 -49 -66 -62\n        -73 -145 -74 -61 -1 -78 10 -56 36 18 23 787 534 944 629 264 158 511 261 724\n        303 306 58 755 72 1150 35z m968 -170 c683 -169 1253 -384 1306 -493 23 -47 2\n        -75 -74 -99 -65 -21 -409 -51 -1115 -96 -317 -21 -403 -22 -417 -8 -9 9 -5 95\n        16 369 16 197 30 361 33 366 9 15 70 6 251 -39z m-649 -771 c23 -27 60 -86 83\n        -132 l43 -84 -1 -116 c0 -85 -6 -139 -22 -201 -63 -244 -227 -585 -367 -765\n        -196 -251 -445 -414 -715 -469 -58 -11 -213 -17 -670 -26 -575 -10 -1148 -22\n        -1701 -36 -180 -5 -268 -4 -272 3 -8 13 -75 872 -84 1063 -6 153 5 245 42 353\n        59 169 251 414 292 374 3 -4 -28 -42 -68 -85 -82 -88 -127 -157 -168 -259 -44\n        -109 -55 -169 -56 -303 0 -179 73 -1071 89 -1088 11 -11 105 -11 532 -2 285 6\n        850 17 1254 25 813 15 802 14 982 85 113 44 261 139 364 234 139 128 248 297\n        383 595 116 259 133 314 139 447 6 161 -25 259 -114 354 -24 26 -44 54 -44 64\n        0 31 38 16 79 -31z m-6110 -197 c9 -11 1 -27 -40 -76 -123 -146 -359 -326\n        -552 -420 -174 -84 -373 -141 -392 -111 -23 39 203 253 417 394 149 98 339\n        183 483 216 58 13 71 13 84 -3z m10679 -187 c24 -47 46 -103 49 -126 l5 -40\n        -152 -6 c-84 -4 -288 -7 -453 -7 -273 0 -308 2 -377 21 -84 22 -245 98 -242\n        114 1 14 36 19 532 75 245 27 459 51 475 53 17 3 50 4 75 3 l45 -1 43 -86z\n        m-9608 -356 c151 -37 345 -145 446 -248 102 -105 190 -278 220 -432 40 -212\n        -6 -417 -140 -617 -121 -182 -240 -273 -441 -342 -108 -36 -280 -44 -405 -19\n        -128 26 -280 86 -348 138 -158 122 -275 292 -324 472 -71 259 10 594 193 789\n        142 152 330 250 534 280 51 7 197 -4 265 -21z m7274 2 c145 -38 253 -97 363\n        -199 309 -287 370 -722 153 -1087 -106 -179 -296 -319 -505 -373 -89 -23 -242\n        -38 -310 -31 -327 34 -645 313 -730 640 -64 246 13 568 184 772 195 233 559\n        352 845 278z m-9621 -370 c76 -20 124 -45 170 -90 34 -34 87 -121 87 -145 0\n        -6 -55 -10 -155 -10 l-155 0 0 -29 0 -30 -111 -3 c-61 -2 -119 0 -128 4 -11 4\n        -20 21 -24 43 -3 21 -17 47 -32 60 -43 40 -32 115 23 160 64 51 213 69 325 40z\n        m-51 -353 c6 -6 11 -37 12 -69 l1 -58 -112 -3 c-127 -3 -125 -4 -138 82 -5 36\n        -3 51 7 58 17 12 217 3 230 -10z m-2 -172 c0 -19 -30 -84 -48 -103 -22 -24\n        -85 -57 -110 -57 -16 0 -22 13 -35 78 -8 42 -13 80 -10 85 7 11 203 9 203 -3z"/>\n        <path d="M2521 3085 c-358 -78 -560 -298 -616 -672 -18 -120 -18 -186 -1 -283\n        42 -229 178 -402 401 -510 147 -71 244 -94 385 -93 405 2 725 282 782 682 26\n        185 -49 440 -177 603 -171 217 -497 333 -774 273z"/>\n        <path d="M9807 3090 c-180 -32 -321 -103 -438 -220 -72 -71 -94 -101 -136\n        -187 -69 -137 -88 -223 -88 -393 1 -128 3 -140 33 -221 109 -287 306 -467 574\n        -525 100 -21 294 -21 378 1 234 60 406 191 499 377 63 128 83 218 84 378 1\n        163 -15 236 -78 365 -97 200 -251 330 -475 405 -73 25 -268 36 -353 20z"/>\n        <path d="M5615 4861 c-172 -79 -299 -140 -745 -359 -135 -66 -357 -175 -495\n        -242 -236 -116 -441 -213 -494 -236 -23 -10 -22 -11 28 -33 141 -60 447 -101\n        546 -72 17 4 163 96 325 203 383 253 704 458 910 581 91 54 169 102 174 107 8\n        8 -61 129 -74 129 -3 0 -81 -35 -175 -78z"/>\n        </g>\n        </svg>\n        ',e}}class r{constructor(e){Object.defineProperty(this,"carInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"car",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"classList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopBut",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"startBut",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"selectBut",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"removeBut",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"title",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"carImg",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"finishFlag",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"animationId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"onSelect",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onRemove",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onStop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.classList=e.classList,this.carInfo=e.carInfo,this.car=new a({id:this.carInfo.id,color:this.carInfo.color}),this.onSelect=e.onSelect,this.onRemove=e.onRemove,this.onStart=e.onStart,this.onStop=e.onStop}render(){const e=this.createMainBlock();return e.appendChild(this.createTitleAndButtonsWrap()),e.appendChild(this.createImageAndButtonsWrap()),e}createMainBlock(){const e=document.createElement("div");return e.classList.add("stripe-wrap",`stripe-${this.carInfo.id}`),e}createTitleAndButtonsWrap(){const e=document.createElement("div");return e.classList.add("title-buttons-wrap"),e.appendChild(this.createButtonsConfig()),e.appendChild(this.createTitle()),e}createButtonsConfig(){const e=document.createElement("div");return e.classList.add("buttons-config"),e.appendChild(this.createSelectButton()),e.appendChild(this.createRemoveButton()),e}createSelectButton(){return this.selectBut=new e({text:"Select",classList:["select-but",`select-but-${this.carInfo.id}`,"button"],onClick:()=>this.onSelect()}).render(),this.selectBut}createRemoveButton(){return this.removeBut=new e({text:"Remove",classList:["remove-but",`remove-but-${this.carInfo.id}`,"button"],onClick:this.onRemove}).render(),this.removeBut}createTitle(){return this.title=document.createElement("h2"),this.title.classList.add("name-car"),this.title.textContent=this.carInfo.name,this.title}createImageAndButtonsWrap(){const e=document.createElement("div");return e.classList.add("image-buttons-wrap","stripe-wrap"),e.appendChild(this.createButtonsControl()),e.appendChild(this.createCarImage()),e.appendChild(this.createFinishFlag()),e}createButtonsControl(){const e=document.createElement("div");return e.classList.add("buttons-control"),e.appendChild(this.createStartButton()),e.appendChild(this.createStopButton()),e}createStartButton(){return this.startBut=new e({text:"A",classList:["control-but","start-but",`start-but-${this.carInfo.id}`],onClick:this.onStart}).render(),this.startBut}createStopButton(){return this.stopBut=new e({text:"B",classList:["control-but","stop-but",`stop-but-${this.carInfo.id}`],disabled:!0,onClick:this.onStop}).render(),this.stopBut}createCarImage(){return this.carImg=this.car.render(),this.carImg}createFinishFlag(){return this.finishFlag=document.createElement("div"),this.finishFlag.innerHTML='<?xml version="1.0" encoding="utf-8"?>\n        <svg height="35" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="red">\n        <path d="M5 22V14M5 14L7.47067 13.5059C9.1212 13.1758 10.8321 13.3328 12.3949 13.958C14.0885 14.6354 15.9524 14.7619 17.722 14.3195L17.8221 14.2945C18.4082 14.148 18.6861 13.4769 18.3753 12.9589L16.8147 10.3578C16.4732 9.78863 16.3024 9.50405 16.2619 9.19451C16.2451 9.06539 16.2451 8.93461 16.2619 8.80549C16.3024 8.49595 16.4732 8.21137 16.8147 7.64221L18.0932 5.51132C18.4278 4.9536 17.9211 4.26972 17.2901 4.42746C15.8013 4.79967 14.2331 4.69323 12.8082 4.12329L12.3949 3.95797C10.8321 3.33284 9.1212 3.17576 7.47067 3.50587L5 4M5 14V11M5 4V2M5 4V7" stroke="#1C274C" stroke-width="0.7" stroke-linecap="round"/>\n        </svg>',this.finishFlag.classList.add("finish-flag",`finish-flag-${this.carInfo.id}`),this.finishFlag}}class i{constructor(e,t){Object.defineProperty(this,"app",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wrapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"title",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputBlock",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"toWinners",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"toGarage",{enumerable:!0,configurable:!0,writable:!0,value:null}),this.app=e,this.wrapper=document.createElement("div"),this.wrapper.classList.add("wrapper"),this.title=document.createElement("h1"),this.title.classList.add("title"),this.wrapper.appendChild(this.renderMoveButtons(t)),document.body.appendChild(this.wrapper)}renderMoveButtons(t){const a=document.createElement("div");return a.classList.add("moveButtons-wrap"),this.toGarage=new e({text:"To garage",classList:["toGarage","button"],disabled:t===m.GARAGE,onClick:()=>{this.wrapper.remove(),this.app.navigate(m.GARAGE)}}).render(),this.toWinners=new e({text:"To winners",classList:["toWinners","button"],disabled:t===m.WINNERS,onClick:()=>{this.wrapper.remove(),this.app.navigate(m.WINNERS)}}).render(),a.appendChild(this.toGarage),a.appendChild(this.toWinners),a}}var n,s,o,l;!function(e){e.CreateNameInput="createNameInput",e.ColorCreateInput="colorCreateInput",e.UpdateNameInput="updateNameInput",e.ColorUpdateInput="colorUpdateInput"}(n||(n={}));class c extends i{constructor(e,t,a){super(e,m.GARAGE),Object.defineProperty(this,"dataService",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"cars",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"storage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"createInput",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"colorCreateInput",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"updateInput",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"updateButton",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"colorUpdateInput",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"pageElement",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"controlWrap",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"raceButton",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"raceBlock",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"resetButton",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"generateButton",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"allCount",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"pageNumber",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"stripeArray",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"selectedId",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"paginationBlock",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"nextPage",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"prevPage",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"countPageElement",{enumerable:!0,configurable:!0,writable:!0,value:7}),Object.defineProperty(this,"countGenerate",{enumerable:!0,configurable:!0,writable:!0,value:100}),Object.defineProperty(this,"brandNames",{enumerable:!0,configurable:!0,writable:!0,value:["Tesla","Ford","BMW","Mercedes","Toyota","Honda","Chevrolet","Audi","Volkswagen","Nissan"]}),Object.defineProperty(this,"modelNames",{enumerable:!0,configurable:!0,writable:!0,value:["Model S","Mustang","X5","E-Class","Camry","Civic","Silverado","A4","Golf","Altima"]}),this.dataService=a,this.storage=t,this.getDataFromStorage(),this.wrapper.appendChild(this.renderInputBlock()),this.wrapper.appendChild(this.renderControlBlock()),this.setupDataAndRender()}async setupDataAndRender(){await this.getData(this.storage.getPageNumber()),this.render()}getDataFromStorage(){this.pageNumber=this.storage.getPageNumber(),this.selectedId=this.storage.getSelectedId()}async getData(e){try{this.data=await this.dataService.getCars(e),this.allCount=this.data.totalCount,this.cars=this.data.cars}catch(e){throw new Error("Failed to initialize DataService")}}render(){this.wrapper.appendChild(this.renderTitle()),this.wrapper.appendChild(this.renderNumPage()),this.wrapper.appendChild(this.renderRaceBlock()),this.wrapper.appendChild(this.renderPagination())}selectCar(e,t,a){this.selectedId=e,this.storage.setSelected(this.selectedId),this.updateInput&&this.updateButton&&this.colorUpdateInput&&(this.updateInput.value=t,this.colorUpdateInput.value=a,this.updateButton.disabled=!1,this.storage.setNameUpdate(t),this.storage.setColorUpdate(a))}renderPagination(){return this.paginationBlock=document.createElement("div"),this.paginationBlock.classList.add("pagination-wrap"),this.prevPage=new e({classList:["pagination-but","prev-page","button"],text:"Prev",onClick:()=>this.toPrevPage(),disabled:this.isPrev()}).render(),this.nextPage=new e({classList:["pagination-but","next-page","button"],text:"Next",onClick:()=>this.toNextPage(),disabled:this.isNext()}).render(),this.paginationBlock.append(this.prevPage,this.nextPage),this.paginationBlock}async toNextPage(){this.pageNumber&&this.resetButton&&this.raceButton&&(this.pageNumber+=1,this.resetButton.disabled=!0,this.raceButton.disabled=!1,this.storage.setPageNumber(this.pageNumber),this.removeElements(),await this.getData(this.pageNumber),this.updateView())}async toPrevPage(){this.pageNumber&&this.resetButton&&this.raceButton&&(this.pageNumber-=1,this.resetButton.disabled=!0,this.raceButton.disabled=!1,this.storage.setPageNumber(this.pageNumber),this.removeElements(),await this.getData(this.pageNumber),this.updateView())}isNext(){return!(!(this.pageNumber&&this.allCount&&this.cars)||this.pageNumber*this.countPageElement<this.allCount)}isPrev(){if(this.pageNumber)return this.pageNumber<=1;throw new Error("pageNumber or allCount is not defined")}renderRaceBlock(){return this.stripeArray=[],this.raceBlock=document.createElement("div"),this.raceBlock.classList.add("race-block"),this.pageNumber&&this.cars?.forEach((e=>{const t=new r({carInfo:{id:e.id,name:e.name,color:e.color},classList:["race-stripe",`race-stripe-${e.id}`],onSelect:()=>{this.selectCar(e.id,e.name,e.color)},onRemove:()=>{this.removeCar(e.id)},onStart:()=>this.startCar(t),onStop:()=>this.stopCar(t)});this.stripeArray.push(t),this.raceBlock?.appendChild(t.render())})),this.raceBlock}renderNumPage(){return this.pageElement=document.createElement("h2"),this.pageElement.innerText=`Page №${this.pageNumber}`,this.pageElement.classList.add("page-number"),this.pageElement}renderTitle(){return this.title.innerText=`Garage (${this.allCount})`,this.title}renderControlBlock(){return this.controlWrap=document.createElement("div"),this.controlWrap.classList.add("control-wrap"),this.raceButton=new e({text:"Race",onClick:()=>this.startRace(),disabled:!1,classList:["button","race-button"]}).render(),this.resetButton=new e({text:"Reset",onClick:()=>this.resetRace(),disabled:!1,classList:["button","reset-button"]}).render(),this.generateButton=new e({text:"Generate",onClick:()=>{this.generateCars()},disabled:!1,classList:["button","generate-button"]}).render(),this.controlWrap.append(this.raceButton,this.resetButton,this.generateButton),this.controlWrap}renderInputBlock(){return this.inputBlock=document.createElement("div"),this.inputBlock.classList.add("input-block"),this.inputBlock.append(this.renderCreateBlock(),this.renderUpdateBlock()),this.inputBlock}resetRace(){this.raceButton&&this.resetButton&&(this.raceButton.disabled=!1,this.resetButton.disabled=!0),this.removeElements(),this.updateView()}renderUpdateBlock(){const a=document.createElement("div");return a.classList.add("block","update-block"),this.updateInput=new t({placeholder:"new name car",value:`${this.storage.getNameUpdate()}`,classList:["input-update","input"],type:"text",onChange:this.saveData(n.UpdateNameInput)}).render(),this.colorUpdateInput=new t({classList:["color-input","input"],value:`${this.storage.getColorUpdate()}`,type:"color",onChange:this.saveData(n.ColorUpdateInput)}).render(),this.updateButton=new e({text:"update",onClick:this.updateCar.bind(this),disabled:""===this.updateInput.value,classList:["button","update-button"]}).render(),a.append(this.updateInput,this.colorUpdateInput,this.updateButton),a}renderCreateBlock(){const a=document.createElement("div");a.classList.add("block","create-block"),this.createInput=new t({placeholder:"name car",value:`${this.storage.getNameCreate()}`,classList:["input-create","input"],type:"text",onChange:this.saveData(n.CreateNameInput)}).render(),this.colorCreateInput=new t({classList:["input","color-input"],type:"color",value:`${this.storage.getColorCreate()}`,onChange:this.saveData(n.ColorCreateInput)}).render();const r=new e({text:"create",onClick:this.createCar.bind(this),disabled:!1,classList:["button","create-button"]}).render();return a.append(this.createInput,this.colorCreateInput,r),a}async createCar(){this.createInput?.value&&this.colorCreateInput?.value&&(this.removeElements(),await this.dataService.createCar(this.createInput.value,this.colorCreateInput.value),await this.getData(this.storage.getPageNumber()),this.updateView(),this.createInput.value="",this.colorCreateInput.value="#000000",this.storage.setNameCreate(""),this.storage.setColorCreate("#000000"))}async driveRace(e){if(!(this.raceButton&&this.resetButton&&this.toWinners&&this.nextPage&&this.prevPage&&this.cars))return null;const{cars:t}=this,a=t.map((async t=>{try{return{res:await this.dataService.driveCar(t.id),name:t.name,id:t.id,time:((performance.now()-e)/1e3).toFixed(2)}}catch(e){const a=this.stripeArray.find((e=>e.car.id===t.id));throw a&&a.animationId&&cancelAnimationFrame(a.animationId),new Error(`Error driving car ${t.id}`)}}));try{const e=await Promise.any(a);this.resetButton.disabled=!1,this.toWinners.disabled=!1,this.nextPage.disabled=this.isNext(),this.prevPage.disabled=this.isPrev(),this.showWinner(e),this.dataService.createWinner(e)}catch{this.resetButton.disabled=!1,this.toWinners.disabled=!1,this.nextPage.disabled=this.isNext(),this.prevPage.disabled=this.isPrev(),this.showWinner(null)}return 0}async startRace(){if(!(this.raceButton&&this.resetButton&&this.toWinners&&this.nextPage&&this.prevPage&&this.cars))return null;this.raceButton.disabled=!0,this.resetButton.disabled=!0,this.toWinners.disabled=!0,this.nextPage.disabled=!0,this.prevPage.disabled=!0;const{cars:e}=this,t=[];let a=[];for(let a=0;a<e.length;a+=1){const r=this.dataService.switchCar(e[a].id,"started");t.push(r)}a=await Promise.all(t);const r=performance.now();for(let t=0;t<e.length;t+=1)if(null!==e){const r=this.stripeArray.find((a=>a.car.id===e[t].id));r&&this.animate(a[t].velocity,a[t].distance,r)}return this.driveRace(r)}showWinner(e){const t=document.createElement("div"),a=document.createElement("h3");a.innerText=e?`${e.name} went first - (${e.time}s)`:"there is no winner",t.classList.add("message-wrap","show"),a.classList.add("message"),t.appendChild(a),this.wrapper.appendChild(t)}animate(e,t,a){const r=+e,i=+t,n=Math.floor(i/r),s=a.carImg,o=a.finishFlag;if(!(o&&s&&a.startBut&&a.stopBut))throw new Error("element not found");{a.startBut.disabled=!0,a.stopBut.disabled=!1;const e=s.offsetWidth,t=s.getBoundingClientRect(),r=o.getBoundingClientRect(),i=r.left-t.left;let l=null;const c=o=>{l||(l=o);const h=o-l;if(e){const o=t.left-e+h/n*i;a.carImg&&(a.carImg.style.transform=`translateX(${o}px)`),s&&o<r.left-e&&(a.animationId=requestAnimationFrame(c))}};a.animationId=requestAnimationFrame(c)}}async updateCar(){this.updateInput?.value&&this.colorUpdateInput?.value&&(this.raceBlock&&this.raceBlock.parentNode&&this.raceBlock.parentNode.removeChild(this.raceBlock),this.paginationBlock&&this.paginationBlock.parentNode&&this.paginationBlock.parentNode.removeChild(this.paginationBlock),await this.dataService.updateCar(this.selectedId,this.updateInput.value,this.colorUpdateInput.value),await this.getData(this.storage.getPageNumber()),this.wrapper.appendChild(this.renderRaceBlock()),this.wrapper.appendChild(this.renderPagination()),this.updateInput.value="",this.updateButton&&(this.updateButton.disabled=!0),this.colorUpdateInput.value="000000",this.storage.setNameUpdate(""),this.storage.setColorUpdate("000000"))}async driveCar(e){try{null===await this.dataService.driveCar(e.carInfo.id)&&e.animationId&&cancelAnimationFrame(e.animationId)}catch(t){e.animationId&&cancelAnimationFrame(e.animationId)}}async startCar(e){e.startBut&&this.resetButton&&(e.startBut.disabled=!1,this.resetButton.disabled=!1);try{const t=await this.dataService.switchCar(e.car.id,"started");this.animate(t.velocity,t.distance,e),await this.driveCar(e)}catch(t){throw e.animationId&&cancelAnimationFrame(e.animationId),new Error(`Error during start car: ${e.car.id}`)}}async stopCar(e){try{await this.dataService.switchCar(e.carInfo.id,"stopped"),e&&e.carImg&&e.startBut&&e.stopBut&&e.animationId&&e.animationId&&e.carImg&&e.startBut&&e.stopBut&&(cancelAnimationFrame(e.animationId),e.carImg.style.transform="translate(0, 0)",e.startBut.disabled=!1,e.stopBut.disabled=!0)}catch{throw new Error("Error during stop car")}}removeElements(){const e=document.querySelector(".message-wrap");e?.remove(),this.pageElement&&this.pageElement.parentNode&&this.pageElement.parentNode.removeChild(this.pageElement),this.title&&this.title.parentNode&&this.title.parentNode.removeChild(this.title),this.raceBlock&&this.raceBlock.parentNode&&this.raceBlock.parentNode.removeChild(this.raceBlock),this.paginationBlock&&this.paginationBlock.parentNode&&this.paginationBlock.parentNode.removeChild(this.paginationBlock)}updateView(){this.wrapper.appendChild(this.renderTitle()),this.wrapper.appendChild(this.renderNumPage()),this.wrapper.appendChild(this.renderRaceBlock()),this.wrapper.appendChild(this.renderPagination())}getRandomColorRGB(){const e=Math.floor(256*Math.random()),t=Math.floor(256*Math.random()),a=Math.floor(256*Math.random());return this.rgbToHex(`rgb(${e}, ${t}, ${a})`)}rgbToHex(e){const t=e.match(/\d+/g);if(t){const[e,a,r]=t;return`#${("0"+parseInt(e,10).toString(16)).slice(-2)}${("0"+parseInt(a,10).toString(16)).slice(-2)}${("0"+parseInt(r,10).toString(16)).slice(-2)}`}return""}async generateCars(){const e=[];for(let t=0;t<this.countGenerate;t+=1){const t=this.brandNames[Math.floor(Math.random()*this.brandNames.length)],a=this.modelNames[Math.floor(Math.random()*this.modelNames.length)],r=this.getRandomColorRGB(),i=this.dataService.createCar(`${t} ${a}`,r);e.push(i)}await Promise.all(e),await this.getData(this.storage.getPageNumber()),this.removeElements(),this.updateView()}async removeCar(e){this.removeElements(),await this.dataService.removeCar(e),await this.getData(this.storage.getPageNumber()),this.updateView()}saveData(e){return()=>{switch(e){case n.CreateNameInput:this.createInput&&this.storage.setNameCreate(this.createInput.value);break;case n.ColorCreateInput:this.colorCreateInput&&this.storage.setColorCreate(this.colorCreateInput.value);break;case n.UpdateNameInput:this.updateInput&&this.storage.setNameUpdate(this.updateInput.value);break;case n.ColorUpdateInput:this.colorUpdateInput&&this.storage.setColorUpdate(this.colorUpdateInput.value);break;default:throw new Error("Error: invalid action type")}}}}!function(e){e.ASC="asc",e.DESC="desc",e.NONE="none"}(s||(s={}));class h{constructor(){Object.defineProperty(this,"pageNumber",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeSort",{enumerable:!0,configurable:!0,writable:!0,value:s.NONE}),Object.defineProperty(this,"idSort",{enumerable:!0,configurable:!0,writable:!0,value:s.ASC}),Object.defineProperty(this,"winsSort",{enumerable:!0,configurable:!0,writable:!0,value:s.NONE}),this.pageNumber=1}getPageNumber(){return this.pageNumber}setPageNumber(e){this.pageNumber=e}getIdSort(){return this.idSort}setIdSort(e){this.idSort=e}getTimeSort(){return this.timeSort}setTimeSort(e){this.timeSort=e}getWinsSort(){return this.winsSort}setWinsSort(e){this.winsSort=e}}!function(e){e.CarNumber="Car Number",e.Image="Image",e.Name="Name",e.Wins="Wins",e.BestTime="Best Time (s)"}(o||(o={}));class d extends i{constructor(e,t,a){super(e,m.WINNERS),Object.defineProperty(this,"storage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"dataService",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pageElement",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"controlWrap",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"raceButton",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"resetButton",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"generateButton",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"tableWrapper",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"countWinners",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"winners",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"winnersInfo",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"pageNumber",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"countColumns",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"timeSort",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"winsSort",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"idSort",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"paginationBlock",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"nextPage",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"prevPage",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"countPageElement",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:[o.CarNumber,o.Image,o.Name,o.Wins,o.BestTime]}),this.storage=t,this.timeSort=this.storage.getTimeSort(),this.idSort=this.storage.getIdSort(),this.winsSort=this.storage.getWinsSort(),this.dataService=a,this.getDataFromService(),this.getData(this.storage.getPageNumber())}async getData(e){try{this.data=await this.dataService.getWinners(e),this.winners=this.data.winners;const t=[];if(0===this.winners.length)return;for(let e=0;e<this.winners.length;e+=1){const a=this.dataService.getCar(this.winners[e].id);t.push(a)}this.winnersInfo=await Promise.all(t),this.countWinners=this.data.totalCount,this.render()}catch(e){throw new Error("Failed to initialize DataService")}}isNext(){if(this.pageNumber&&this.countWinners&&this.winners)return!(this.pageNumber*this.countPageElement<this.countWinners);throw new Error("pageNumber or allCount or cars is not defined")}isPrev(){if(this.pageNumber)return this.pageNumber<=1;throw new Error("pageNumber or allCount is not defined")}async toNextPage(){this.pageNumber&&this.idSort&&this.timeSort&&this.winsSort&&(this.pageNumber+=1,this.storage.setPageNumber(this.pageNumber),this.removeElements(),await this.getData(this.pageNumber))}async toPrevPage(){this.pageNumber&&this.idSort&&this.timeSort&&this.winsSort&&(this.pageNumber-=1,this.storage.setIdSort(this.idSort),this.storage.setTimeSort(this.timeSort),this.storage.setWinsSort(this.winsSort),this.storage.setPageNumber(this.pageNumber),this.removeElements(),await this.getData(this.pageNumber))}removeElements(){this.pageElement&&this.pageElement.parentNode&&this.pageElement.parentNode.removeChild(this.pageElement),this.title&&this.title.parentNode&&this.title.parentNode.removeChild(this.title),this.tableWrapper&&this.tableWrapper.parentNode&&this.tableWrapper.parentNode.removeChild(this.tableWrapper),this.paginationBlock&&this.paginationBlock.parentNode&&this.paginationBlock.parentNode.removeChild(this.paginationBlock)}getDataFromService(){this.pageNumber=this.storage.getPageNumber(),this.timeSort=this.storage.getTimeSort(),this.idSort=this.storage.getIdSort(),this.winsSort=this.storage.getWinsSort()}render(){this.wrapper.appendChild(this.renderTitle()),this.wrapper.appendChild(this.renderNumPage()),this.winners&&this.wrapper.appendChild(this.renderWinnerTable(this.winners)),this.wrapper.appendChild(this.renderPagination())}renderPagination(){return this.paginationBlock=document.createElement("div"),this.paginationBlock.classList.add("pagination-wrap"),this.prevPage=new e({classList:["pagination-but","prev-page","button"],text:"Prev",onClick:()=>this.toPrevPage(),disabled:this.isPrev()}).render(),this.nextPage=new e({classList:["pagination-but","next-page","button"],text:"Next",onClick:()=>this.toNextPage(),disabled:this.isNext()}).render(),this.paginationBlock.append(this.prevPage,this.nextPage),this.paginationBlock}renderTitle(){return this.title.innerText=`Winners (${this.countWinners})`,this.title}renderNumPage(){return this.pageElement=document.createElement("h2"),this.pageElement.innerText=`Page №${this.pageNumber}`,this.pageElement.classList.add("page-number"),this.pageElement}saveDataSort(){this.storage.setIdSort(this.idSort),this.storage.setTimeSort(this.timeSort),this.storage.setWinsSort(this.winsSort)}sortTable(e){if(this.paginationBlock&&this.paginationBlock.parentNode&&this.paginationBlock.parentNode.removeChild(this.paginationBlock),this.tableWrapper&&this.tableWrapper.parentNode&&this.winners){switch(this.tableWrapper.parentNode.removeChild(this.tableWrapper),e){case"wins":this.timeSort=s.NONE,this.idSort=s.NONE,this.winsSort=this.winsSort!==s.ASC?s.ASC:s.DESC;break;case"time":this.winsSort=s.NONE,this.idSort=s.NONE,this.timeSort=this.timeSort!==s.ASC?s.ASC:s.DESC;break;case"id":this.timeSort=s.NONE,this.winsSort=s.NONE,this.idSort=this.idSort!==s.ASC?s.ASC:s.DESC;break;default:throw new Error("Invalid data of the sort type")}this.wrapper.append(this.renderWinnerTable(this.winners))}this.saveDataSort(),this.wrapper.appendChild(this.renderPagination())}renderWinnerTable(e){let t=e.map((e=>({...e})));this.tableWrapper=document.createElement("div"),this.tableWrapper.classList.add("table-wrap");const a=document.createElement("table");return a.classList.add("table"),this.renderTableHeaders(a),this.timeSort!==s.NONE?this.timeSort&&(t=this.timeSorting(this.timeSort,t)):this.winsSort!==s.NONE?this.winsSort&&(t=this.winsSorting(this.winsSort,t)):this.idSort!==s.NONE&&this.idSort&&(t=this.idSorting(this.idSort,t)),this.renderTableRows(a,t,this.headers),this.tableWrapper.appendChild(a),this.tableWrapper}renderTableHeaders(e){const t=document.createElement("tr");this.headers.forEach((e=>{const a=document.createElement("th");a.classList.add("header-cell","cell"),a.textContent=e,e===o.Wins?(a.addEventListener("click",(()=>this.sortTable("wins"))),a.classList.add("column-sort")):e===o.BestTime?(a.addEventListener("click",(()=>this.sortTable("time"))),a.classList.add("column-sort")):e===o.CarNumber&&(a.addEventListener("click",(()=>this.sortTable("id"))),a.classList.add("column-sort")),t.appendChild(a)})),e.appendChild(t)}renderTableRows(e,t,r){t&&t.forEach((t=>{const i=document.createElement("tr"),n=this.winnersInfo?.find((e=>e.id===t.id));if(n){for(let e=0;e<this.countColumns;e+=1){const s=document.createElement("td");switch(s.classList.add("cell"),r[e]){case o.CarNumber:s.textContent=t.id.toString();break;case o.Image:s.appendChild(new a({id:t.id,color:n.color},"car-winner").render());break;case o.Name:s.textContent=n.name;break;case o.Wins:s.textContent=t.wins.toString();break;case o.BestTime:s.textContent=t.time.toString();break;default:throw new Error("Invalid data of the header")}i.appendChild(s)}e.appendChild(i)}}))}timeSorting(e,t){return e===s.ASC?t.sort(((e,t)=>e.time-t.time)):t.sort(((e,t)=>t.time-e.time))}winsSorting(e,t){return e===s.ASC?t.sort(((e,t)=>e.wins-t.wins)):t.sort(((e,t)=>t.wins-e.wins))}idSorting(e,t){return e===s.ASC?t.sort(((e,t)=>e.id-t.id)):t.sort(((e,t)=>t.id-e.id))}}class u{constructor(){Object.defineProperty(this,"nameCreate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"nameUpdate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"colorCreate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"colorUpdate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pageNumber",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"selectedId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.selectedId=-1,this.nameCreate="",this.nameUpdate="",this.colorCreate="",this.colorUpdate="",this.pageNumber=1}getNameCreate(){return this.nameCreate}getNameUpdate(){return this.nameUpdate}getColorCreate(){return this.colorCreate}getColorUpdate(){return this.colorUpdate}getPageNumber(){return this.pageNumber}getSelectedId(){return this.selectedId}setNameCreate(e){this.nameCreate=e}setNameUpdate(e){this.nameUpdate=e}setColorCreate(e){this.colorCreate=e}setColorUpdate(e){this.colorUpdate=e}setPageNumber(e){this.pageNumber=e}setSelected(e){this.selectedId=e}}!function(e){e[e.BAD_REQUEST=400]="BAD_REQUEST",e[e.NOT_FOUND=404]="NOT_FOUND",e[e.TOO_MANY_REQUESTS=429]="TOO_MANY_REQUESTS",e[e.SERVER_ERROR=500]="SERVER_ERROR"}(l||(l={}));const p={[l.BAD_REQUEST]:'Wrong parameters: "id" should be any positive number, "status" should be "started", "stopped" or "drive"',[l.NOT_FOUND]:"Engine parameters for car with such id was not found in the garage.",[l.TOO_MANY_REQUESTS]:"Drive already in progress. You can't run drive for the same car twice while it's not stopped.",[l.SERVER_ERROR]:"Car has been stopped."};class b{constructor(e){Object.defineProperty(this,"baseUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.baseUrl=e}async getCars(e=1,t=7){const a=`/garage?_page=${e}&_limit=${t}`,r=await fetch(`${this.baseUrl}${a}`);if(!r.ok)throw new Error(`Failed to fetch data. Status: ${r.status}`);const i=Number(r.headers.get("X-Total-Count"));return{cars:await r.json(),totalCount:i}}async getCar(e=1){const t=`/garage/${e}`,a=await fetch(`${this.baseUrl}${t}`);if(!a.ok)throw new Error(`Failed to fetch data. Status: ${a.status}`);return await a.json()}async getWinners(e=1,t=10,a="id",r="ASC"){const i=`/winners?_page=${e}&_limit=${t}&_sort=${a}&_order=${r}`,n=await fetch(`${this.baseUrl}${i}`);if(!n.ok)throw new Error(`Failed to fetch winners data. Status: ${n.status}`);const s=Number(n.headers.get("X-Total-Count"));return{winners:await n.json(),totalCount:s}}async createCar(e,t){const a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,color:t})},r=await fetch(`${this.baseUrl}/garage`,a);if(!r.ok)throw new Error(`Failed to create car. Status: ${r.status}`);return await r.json()}async updateCar(e,t,a){const r=`/garage/${e}`,i={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,color:a})},n=await fetch(`${this.baseUrl}${r}`,i);if(!n.ok)throw new Error(`Failed to create car. Status: ${n.status}`);return await n.json()}async removeCar(e){const t=`/garage/${e}`;await this.removeCarWinners(e);const a=await fetch(`${this.baseUrl}${t}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!a.ok)throw new Error(`Failed to remove car. Status: ${a.status}`);return await a.json()}async removeCarWinners(e){const t=`/winners/${e}`,a=await fetch(`${this.baseUrl}${t}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});return 404===a.status?null:await a.json()}async startRace(e){const t=[];for(let a=0;a<e.length;a+=1){const r=this.switchCar(e[a].id,"started");t.push(r)}await Promise.all(t);const a=[];for(let t=0;t<e.length;t+=1){const r=this.driveCar(e[t].id);a.push(r)}try{await Promise.any(a)}catch(e){throw new Error("all promises were rejected")}}async driveCar(e){try{const t=`/engine?id=${e}&status=drive`,a={method:"PATCH"},r=await fetch(this.baseUrl+t,a);if(!r.ok){if(400===r.status)throw new Error(`${p[l.BAD_REQUEST]}`);if(404===r.status)throw new Error(`${p[l.NOT_FOUND]}`);if(500===r.status)throw new Error(`${p[l.SERVER_ERROR]}id: ${e}}`)}return await r.json()}catch{throw new Error("Error during drive car")}}async switchCar(e,t){try{const a=`/engine?id=${e}&status=${t}`,r={method:"PATCH"},i=await fetch(this.baseUrl+a,r);return await i.json()}catch(e){if(e instanceof TypeError&&"Failed to fetch"===e.message)throw new Error("Failed to fetch");if(e instanceof Error)throw new Error(`Error: ${e.message}`);throw new Error("Unknown error")}}async getWinner(e=1){const t=`/winners/${e}`,a=await fetch(`${this.baseUrl}${t}`);if(!a.ok)throw new Error(`Failed to fetch data. Status: ${a.status}`);return await a.json()}async updateWinner(e,t){const a=`/winners/${e.id}`,r=+e.time,i=t.wins+1,n={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({wins:i,time:r})};try{await fetch(`${this.baseUrl}${a}`,n)}catch{throw new Error("Failed to update winner. Status: 404")}}async updateCountWins(e){const t=`/winners/${e.id}`,a=+e.time,r=e.wins+1,i={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({wins:r,time:a})};try{await fetch(`${this.baseUrl}${t}`,i)}catch{throw new Error("Failed to update winner. Status: 404")}}async createWinner(e){try{const t=await this.getWinner(e.id);t.time>+e.time?await this.updateWinner(e,t):await this.updateCountWins({id:e.id,wins:t.wins+1,time:t.time})}catch{const t="/winners",a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e.id,wins:1,time:+e.time})};try{await fetch(`${this.baseUrl}${t}`,a)}catch{throw new Error("Error: insert failed, duplicate id")}}}}var m;!function(e){e[e.WINNERS=0]="WINNERS",e[e.GARAGE=1]="GARAGE"}(m||(m={})),(new class{constructor(){Object.defineProperty(this,"currentPage",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"dataService",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"garageStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"winnersStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.dataService=new b("http://127.0.0.1:3000"),this.garageStorage=new u,this.winnersStorage=new h}async start(){this.currentPage=new c(this,this.garageStorage,this.dataService)}navigate(e){switch(e){case m.GARAGE:this.currentPage=new c(this,this.garageStorage,this.dataService);break;case m.WINNERS:this.currentPage=new d(this,this.winnersStorage,this.dataService);break;default:this.currentPage=new c(this,this.garageStorage,this.dataService)}}}).start()})();